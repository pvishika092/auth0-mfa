<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Verify Your Identity</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  :root {
    --primary: #3aa378;
    --primary-soft: #42ce9110;
    --text-main: #0f172a;
    --text-muted: #475569;
    --border-soft: #e5e7eb;
    --card-bg: #ffffff;
  }

  * {
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", sans-serif;
  }

  body {
    margin: 0;
    min-height: 100vh;
    background:
      linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)),
      url('https://holmes-static-assets.s3.ap-south-1.amazonaws.com/Pantopic-bg-light.png');
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-main);
  }

  .container { width: 100%; max-width: 1100px; padding: 32px; }
  .header { text-align: center; margin-bottom: 32px; }
  .header h1 { font-size: 30px; margin-bottom: 6px; }
  .header p { font-size: 14px; color: var(--text-muted); }
  .split { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .card { background: var(--card-bg); border-radius: 20px; padding: 28px; box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08); border: 1px solid var(--border-soft); }
  .step { display: flex; gap: 16px; margin-bottom: 28px; }
  .step-number { width: 36px; height: 36px; border-radius: 12px; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0; }
  .step h3 { margin: 0 0 6px; font-size: 16px; }
  .step p { font-size: 14px; color: var(--text-muted); line-height: 1.5; }
  .verify-title { text-align: center; font-weight: 600; margin-bottom: 6px; }
  .verify-sub { text-align: center; font-size: 13px; color: var(--text-muted); margin-bottom: 18px; }
  .email-box { background: #f8fafc; border: 1px solid var(--border-soft); border-radius: 12px; padding: 14px; text-align: center; font-size: 14px; margin-bottom: 20px; }
  .code-input input { width: 100%; padding: 16px; font-size: 26px; text-align: center; letter-spacing: 12px; border-radius: 14px; border: 1px solid var(--border-soft); }
  .button { width: 100%; margin-top: 20px; padding: 14px; border-radius: 999px; border: none; background: var(--primary); color: white; font-size: 16px; font-weight: 600; cursor: pointer; }
  .button:disabled { opacity: 0.6; cursor: not-allowed; }
  .error { margin-top: 16px; padding: 14px; border-radius: 12px; background: #fee2e2; color: #991b1b; font-weight: 600; text-align: center; display: none; }
  .hint { text-align: center; font-size: 12px; margin-top: 14px; color: var(--text-muted); }
  @media (max-width: 900px) { .split { grid-template-columns: 1fr; } }
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>Verify Your Identity</h1>
    <p>One final step to securely sign in</p>
  </div>

  <div class="split">
    <!-- LEFT -->
    <div class="card">
      <div class="step">
        <div class="step-number">1</div>
        <div>
          <h3>Open your authenticator app</h3>
          <p>Use Google Authenticator, Microsoft Authenticator, Authy, or any compatible app installed on your device.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div>
          <h3>Find the code for YourApp</h3>
          <p>Look for the account labeled <strong>YourApp</strong>. The 6-digit code refreshes every 30 seconds.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div>
          <h3>Enter the code to continue</h3>
          <p>Once verified, you’ll be securely signed in to your account.</p>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <div class="verify-title">Enter verification code</div>
      <div class="verify-sub">From your authenticator app</div>

      <div class="email-box">
         Signing in as <strong><span id="email"></span></strong>
      </div>

      <div class="code-input">
        <input type="text" id="code" maxlength="6" inputmode="numeric" placeholder="000000" autofocus />
      </div>

      <button class="button" id="verifyBtn" onclick="verifyCode()">Verify & Continue</button>

      <div id="error" class="error"></div>

      <div class="hint">
        Codes refresh every 30 seconds • Connection is secure
      </div>
    </div>
  </div>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const email = params.get('email');
  const state = params.get('state');
  let attemptsLeft = parseInt(params.get('attemptsLeft') || '3', 10);
  const errorMessage = params.get('error');

  document.getElementById('email').textContent =
    email && email !== 'null' ? email : 'your account';

  if (errorMessage) {
    const errorDiv = document.getElementById('error');
    errorDiv.textContent = `${errorMessage} (${attemptsLeft} attempt${attemptsLeft > 1 ? 's' : ''} left)`;
    errorDiv.style.display = 'block';
  }

  function verifyCode() {
    const code = document.getElementById('code').value.trim();
    const error = document.getElementById('error');
    const btn = document.getElementById('verifyBtn');

    error.style.display = 'none';

    if (!/^\d{6}$/.test(code)) {
      error.textContent = 'Please enter a valid 6-digit code';
      error.style.display = 'block';
      return;
    }

    if (attemptsLeft <= 0) {
      error.textContent = 'Maximum attempts reached. Please try again later.';
      error.style.display = 'block';
      return;
    }

    btn.disabled = true;
    btn.textContent = 'Verifying...';

    // Redirect to Auth0 continue endpoint with state & code
    window.location.href =
      `https://auth.panaroma.ai/continue?state=${state}&code=${code}`;
  }

  document.getElementById('code').addEventListener('input', e => {
    e.target.value = e.target.value.replace(/\D/g, '');
    if (e.target.value.length === 6) setTimeout(verifyCode, 300);
  });

  document.addEventListener('keypress', e => {
    if (e.key === 'Enter') verifyCode();
  });
</script>
</body>
</html>
